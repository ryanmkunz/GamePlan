@model IEnumerable<GamePlan.Models.ToDoList>

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>MainPage</title>
    <script src="~/Scripts/jquery-3.3.1.js"></script>

    <style>
        .card {
            background-color: goldenrod;
        }
    </style>

</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                @Html.ActionLink("Application name", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li>@Html.ActionLink("Events", "Index", "ToDoLists")</li>
                    <li>@Html.ActionLink("Weather", "Weather", "Home")</li>
                    <li>@Html.ActionLink("Recommended", "Recommended", "Events")</li>
                    <li>@Html.ActionLink("Notifications", "Index", "EmailNotify")</li>
                    <li>@Html.ActionLink("Invitations", "Invites", "Events")</li>
                </ul>
                @Html.Partial("_LoginPartial")
            </div>
        </div>
    </div>

    <div id="toDoList"></div>

    <script type="text/javascript">
    $(document).ready(function () {
        var json = @Html.Raw(Json.Encode(@Model));
        getCollection(json);
    });

        function getCollection(collection) {
            createBlankCard();
		for (var i = 0; i <= collection.length - 1; i++) {
			createCard(i,collection[i].Title);
            var events = collection[i].Events;
            if (events.length > 0) {
                for (var j = 0; j <= events.length - 1; j++) {
                    createListItem(i, j, events[j].Description, events[j].Id);
                }
                createTextBox(i, events[0].Category);
            }
            else {
                createTextBox(i, collection[i].Title)
            }            
		}
	}

    function createBlankCard() {
        var card = $('<div class="card" id="blankCard" style="width: 25rem;"><h5 class"card-title">Create New List</ht></div>');
        var toDoListForm = '<form action="/action_page.php" id="blankCardForm"></form>';
        var newToDoListTextBox = '<input type="text" id="blankCardTextBox" value="Add"><span><input type="button" id="blankCardSbtBtn" value="Submit"></span>';
        $('#toDoList').append(card);
        document.getElementById("blankCard").innerHTML += toDoListForm;
        document.getElementById("blankCardForm").innerHTML += newToDoListTextBox;
        $("#blankCardSbtBtn").on('click', function () {
            var newToDoList = {
                Title: $("#blankCardTextBox").val(),
                Category: $("#blankCardTextBox").val()
            };
            createToDoList(newToDoList);
            document.location.reload();
        });
    }

	function createCard(cardNum, cartTitle){
		var cardId = "toDoCard" + cardNum;
		var formId = "toDoListForm" + cardNum;
		var card = $('<div class="card" id="' + cardId + '" style="width: 25rem;"><h5 class="card-title">'+cartTitle+'</h5></div>');
		var toDoListForm = '<form action="/action_page.php" id="' + formId + '"></form>';
		$('#toDoList').append(card);
		document.getElementById(cardId).innerHTML += toDoListForm;
	}

	function createListItem(cardNum, eventNum, content, objectId){
		var formId = "toDoListForm" + cardNum;
        var eventId = "toDoListItem" + cardNum + eventNum;
        var detailsActionLink = '<a href="/Events/Details/' + objectId + '">Details</a>';
        var mapActionLink = '<a href="/Events/Map/' + objectId + '">Map</a>';
        var emailActionLink = '<a href="/EmailNotify/SendReminder/' + objectId + '">Email</a>';
        var deleteActionLink = '<a href="/Events/Delete/' + objectId + '">Delete</a>';
        var editActionLink = '<a href="/Events/Edit/' + objectId + '">Edit</a>';
        var toDoListItem = '<input type="checkbox" id="' + eventId + '"><span>' + content + detailsActionLink + mapActionLink + emailActionLink + editActionLink + deleteActionLink + '</span><br>';
        document.getElementById(formId).innerHTML += toDoListItem;
    }

    function createTextBox(cardNum, category) {
        var formId = "toDoListForm" + cardNum;
        var textBoxId = "newEventTextBoxfor" + cardNum;
        var newEventSubmitId = "newEventSubmit" + cardNum;
        var newEventTextBox = '<input type="text" id="' + textBoxId + '" value="Add"><span><input type="button" id="' + newEventSubmitId + '" value="Submit"></span>';
        document.getElementById(formId).innerHTML += newEventTextBox;
        $("#" + newEventSubmitId + "").on('click', function () {
            var newEvent = {
                Description: $("#" + textBoxId + "").val(),
                Category: category
            };
            createEvent(newEvent);
            document.location.reload();
        });
    }

    function createToDoList(newToDoList) {
        $.ajax({
            type: "POST",
            data: JSON.stringify(newToDoList),
            url: "http://localhost:49757/api/ToDoLists",
            contentType: "application/json"
        }).done(function (res) {
            console.log('res', res);
        });
    }

    function createEvent(newEvent) {
        $.ajax({
            type: "POST",
            data: JSON.stringify(newEvent),
            url: "http://localhost:49757/api/Events",
            contentType: "application/json"
        }).done(function (res) {
            console.log('res', res);
            });
    }



    </script>
</body>
</html>

